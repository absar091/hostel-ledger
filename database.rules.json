{
  "rules": {
    ".read": false,
    ".write": false,
    "users": {
      "$uid": {
        ".read": "auth != null",
        ".write": "$uid === auth.uid && auth != null",
        "walletBalance": {
          ".write": false
        },
        "settlements": {
          ".write": false
        },
        ".validate": "newData.hasChildren(['uid', 'email', 'name', 'createdAt']) && newData.child('uid').val() === $uid"
      }
    },
    "groups": {
      "$groupId": {
        ".read": "auth != null && (root.child('userGroups').child(auth.uid).child($groupId).exists() || data.child('createdBy').val() === auth.uid)",
        ".write": "auth != null && (root.child('userGroups').child(auth.uid).child($groupId).exists() || data.child('createdBy').val() === auth.uid || !data.exists())",
        ".validate": "newData.hasChildren(['name', 'emoji', 'members', 'createdBy', 'createdAt'])"
      }
    },
    "userGroups": {
      "$uid": {
        ".read": "$uid === auth.uid",
        ".write": "$uid === auth.uid && auth != null"
      }
    },
    "transactions": {
      "$transactionId": {
        ".read": "auth != null && root.child('userTransactions').child(auth.uid).child($transactionId).exists()",
        ".write": false,
        ".validate": "newData.hasChildren(['groupId', 'type', 'amount', 'createdAt']) && newData.child('amount').isNumber() && newData.child('amount').val() > 0"
      }
    },
    "userTransactions": {
      "$uid": {
        ".read": "$uid === auth.uid",
        ".write": "$uid === auth.uid && auth != null"
      }
    },
    "verificationCodes": {
      "$codeId": {
        ".read": "auth != null || auth == null",
        ".write": "auth != null || auth == null",
        ".validate": "newData.hasChildren(['email', 'code', 'createdAt']) && newData.child('code').isString() && newData.child('email').isString()"
      }
    },
    "emailVerification": {
      "$uid": {
        ".read": "$uid === auth.uid || auth == null",
        ".write": "$uid === auth.uid || auth == null",
        ".validate": "newData.hasChildren(['email', 'emailVerified'])"
      }
    },
    "pushSubscriptions": {
      "$uid": {
        ".read": "$uid === auth.uid",
        ".write": "$uid === auth.uid && auth != null",
        ".validate": "newData.hasChildren(['subscription', 'updatedAt']) || newData.hasChildren(['fcmToken', 'updatedAt'])"
      }
    },
    "oneSignalPlayers": {
      "$uid": {
        ".read": "$uid === auth.uid",
        ".write": "$uid === auth.uid && auth != null",
        ".validate": "newData.hasChildren(['playerId', 'updatedAt']) && newData.child('playerId').isString()"
      }
    },
    "usernames": {
      ".read": true,
      "$username": {
        ".write": "auth != null && (!data.exists() || data.child('uid').val() === auth.uid)",
        ".validate": "newData.hasChildren(['uid', 'createdAt']) && newData.child('uid').isString()"
      }
    },
    "invitations": {
      "$invitationId": {
        ".read": "auth != null && (data.child('invitedBy/uid').val() === auth.uid || data.child('invitee/uid').val() === auth.uid)",
        ".write": "auth != null",
        ".validate": "newData.hasChildren(['groupId', 'invitedBy', 'invitee', 'status', 'createdAt'])"
      }
    },
    "userInvitations": {
      "$uid": {
        ".read": "$uid === auth.uid",
        ".write": "$uid === auth.uid && auth != null"
      }
    }
  }
}